#!/usr/bin/env sh

echo "ğŸš€ Running pre-push checks..."

# Store initial git status
initial_status=$(git status --porcelain)

echo "ğŸ“¦ Installing dependencies..."
bun install
install_exit_code=$?

# Check if bun install failed
if [ $install_exit_code -ne 0 ]; then
    echo "âŒ Bun install failed"
    exit 1
fi

echo "ğŸ—ï¸ Running build..."
bun run build
build_exit_code=$?

# Check if any command failed
if [ $lint_exit_code -ne 0 ] || [ $build_exit_code -ne 0 ]; then
    echo "âŒ Pre-push checks failed"
    if [ $lint_exit_code -ne 0 ]; then
        echo "  - Lint failed"
    fi
    if [ $build_exit_code -ne 0 ]; then
        echo "  - Build failed"
    fi
    exit 1
fi

echo "âœ… All pre-push checks passed!"